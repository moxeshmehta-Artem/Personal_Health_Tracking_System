<div class="card">
  <h2>Dietitian Dashboard</h2>
  <p>Here are your assigned patients.</p>

  <p-table [value]="patients" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
      <tr>
        <th>Patient Name</th>
        <th>Status</th>
        <th>Doctor's Notes</th>
        <th>Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-patient>
      <tr>
        <td>{{ patient.firstname }} {{ patient.lastname }}</td>
        <td>
          <span
            [class]="'text-sm font-bold ' + (patient.consultationStatus === 'active' ? 'text-green-500' : 'text-orange-500')">
            {{ patient.consultationStatus === 'active' ? 'ACTIVE' : 'INACTIVE' }}
          </span>
        </td>
        <td>
          <span *ngIf="patient.notes" class="text-green-600 font-bold">Has Script</span>
          <span *ngIf="!patient.notes" class="text-gray-500">None</span>
        </td>
        <td class="flex gap-2">
          <p-button [label]="patient.consultationStatus === 'active' ? 'End Consult' : 'Start Consult'"
            [styleClass]="patient.consultationStatus === 'active' ? 'p-button-warning p-button-sm' : 'p-button-success p-button-sm'"
            (click)="toggleConsultation(patient)">
          </p-button>
          <p-button label="Script" icon="pi pi-file-edit" styleClass="p-button-sm"
            [disabled]="patient.consultationStatus !== 'active'" (click)="openNoteDialog(patient)"></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog header="Consultation Notes" [(visible)]="displayNoteDialog" [style]="{width: '50vw'}" [modal]="true">
    <div class="flex flex-column gap-3" *ngIf="selectedPatient">
      <p><strong>Patient:</strong> {{ selectedPatient.firstname }} {{ selectedPatient.lastname }}</p>
      <div class="field">
        <label for="notes" class="block mb-2">Prescription / Notes</label>
        <textarea rows="5" pInputTextarea [(ngModel)]="noteContent" class="w-full"></textarea>
      </div>
      <p-button label="Save Notes" (click)="saveNote()"></p-button>
    </div>
  </p-dialog>
</div>